<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dev.mvc.restaurant.RestaurantDAOInter">
    <select id="checkID" resultType="int" parameterType="String">
        SELECT COUNT(id) as cnt
        FROM owner
        WHERE id=#{id}
    </select>




    <insert id="create" parameterType="dev.mvc.restaurant.RestaurantVO">
        INSERT INTO restaurant(restno, name, tel,ownerno,categoryno)
        VALUES (restaurant_seq.nextval, #{name},#{tel}, #{ownerno}, #{categoryno})
    </insert>



    <select id="nextval" resultType="int">
        SELECT restaurant_seq.nextval AS restno FROM dual
    </select>

	
    <select id="list_search_paging" parameterType="java.util.Map" resultType="dev.mvc.restaurant.RestaurantVO">
        <if test="type == 100">
            <if test="word == null or word == ''">
                <!-- 전체 결과를 가져오는 쿼리 -->
                <![CDATA[
            SELECT restno, name, tel, ownerno, categoryno,thumbfile, r
            FROM (
                     SELECT restno, name, tel, ownerno, categoryno,thumbfile,ROWNUM as r
                     FROM (
                              SELECT s.restno, s.name, s.tel, s.ownerno, s.categoryno ,i.thumbfile
                              FROM restaurant s INNER JOIN restimage i ON s.restno = i.restno
                          )

                 )
            WHERE  r >= #{start_num} AND ROWNUM <= #{end_num} ]]>
            </if>
            <if test="word != null and word != ''">
                <!-- name으로 조회 -->
                <![CDATA[
            SELECT restno, name, tel, ownerno, categoryno, r
            FROM (
                     SELECT restno, name, tel, ownerno, categoryno, ROWNUM as r
                     FROM (
                              SELECT restno, name, tel, ownerno, categoryno
                              FROM restaurant INNER JOIN restimage ON restaurant.restno = restimage.restno
                              WHERE name LIKE '%' || #{word} || '%'
                          )

                 )
            WHERE r >= #{start_num} AND r <= #{end_num} ]]>
            </if>
        </if>
        <if test="type == 200">
            <if test="word == null or word == ''">
                <!-- 전체 결과를 가져오는 쿼리 -->
                <![CDATA[
            SELECT restno, name, tel, ownerno, categoryno, r
            FROM (
                     SELECT restno, name, tel, ownerno, categoryno, ROWNUM as r
                     FROM (
                              SELECT s.restno, s.name, s.tel, s.ownerno, s.categoryno
                              FROM restaurant s INNER JOIN restimage i ON s.restno = i.restno
                          )
                     WHERE ROWNUM <= #{end_num}
                 )
            WHERE r >= #{start_num} ]]>
            </if>
            <if test="word != null and word != ''">
                <!-- ownerno으로 조회 -->
                <![CDATA[
            SELECT restno, name, tel, ownerno, categoryno, r
            FROM (
                     SELECT restno, name, tel, ownerno, categoryno, ROWNUM as r
                     FROM (
                              SELECT r.restno, r.name, r.tel, r.ownerno, r.categoryno
                              FROM restaurant  r INNER JOIN restimage i ON restaurant.restno = restimage.restno
                              WHERE ownerno LIKE '%' || #{word} || '%'
                          )
                     WHERE ROWNUM <= #{end_num}
                 )
            WHERE r >= #{start_num} ]]>
            </if>
        </if>
    </select>


    <select id="findByOwnerR" parameterType="int" resultType="dev.mvc.restaurant.RestaurantVO">

     SELECT *
     FROM WHERE ownerno = #{ownerno}


    </select>

    <select id="list_search_count" parameterType="java.util.Map" resultType="int">
        <if test="type == 100">
            <if test="word == null or word == ''">
                <!-- 전체 결과를 가져오는 쿼리 -->
                SELECT count(*) as cnt
                FROM restaurant
            </if>
            <if test="word != null and word != ''">
                <!-- name으로 조회 -->
                SELECT count(*) as cnt
                FROM restaurant
                WHERE name LIKE '%' || #{word} || '%'
            </if>
        </if>
        <if test="type == 200">
            <if test="word == null or word == ''">
                <!-- 전체 결과를 가져오는 쿼리 -->
                SELECT count(*) as cnt
                FROM restaurant
            </if>
            <if test="word != null and word != ''">
                <!-- ownerno으로 조회 -->
                SELECT count(*) as cnt
                FROM restaurant
                WHERE ownerno LIKE '%' || #{word} || '%'
            </if>
        </if>
    </select>



</mapper>