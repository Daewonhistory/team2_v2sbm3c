<?xml version="1.0" encoding="UTF-8"?>
 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dev.mvc.ingredient.IngredientDAOInter"> <!-- SB가 자동으로 구현하여 연동하는 interface -->
  <insert id="create" parameterType="dev.mvc.ingredient.IngredientVO"> <!-- public int create(CateVO cateVO) {...-->
  	INSERT INTO ingredient(ingredno, name)
	VALUES (ingredient_seq.nextval, #{name})
  </insert>
  
  <!-- SQL -> IngredientVO -> ArrayList<IngredientVO> return -->
  <select id="list_all" resultType="dev.mvc.ingredient.IngredientVO">
    SELECT ingredno, name
	FROM ingredient
	ORDER BY name ASC
  </select>
  
  <select id="list_search" parameterType="String" resultType="dev.mvc.ingredient.IngredientVO">
    SELECT ingredno, name
	FROM ingredient
	WHERE name LIKE '%' || #{word} || '%'
	ORDER BY name ASC
  </select>
  
  <select id="read" resultType="dev.mvc.ingredient.IngredientVO">
    SELECT ingredno, name
	FROM ingredient
	WHERE ingredno = #{ingredno}
	ORDER BY name ASC
  </select>
  
  <delete id="delete_by_ingredno" parameterType="int">
  	DELETE FROM ingredient
	WHERE ingredno = #{ingredno}
  </delete>
  
  <update id="update_by_ingredno" parameterType="dev.mvc.ingredient.IngredientVO">
  	UPDATE ingredient
	SET name = #{name}
	WHERE ingredno = #{ingredno}
  </update>
  
  <!-- 카테고리별 검색 + 페이징 목록 -->
  <select id="list_search_paging" resultType="dev.mvc.ingredient.IngredientVO" parameterType="HashMap">
   SELECT ingredno, name, r
   FROM (
              SELECT ingredno, name, rownum as r
              FROM (
                        SELECT ingredno, name
                        FROM ingredient
                        <choose>
                          <when test="word == null or word == ''"> <!-- 검색하지 않는 경우 -->
                          </when>
                          <otherwise>
                            WHERE (UPPER(title) LIKE '%' || UPPER(#{word}) || '%' 
                                                        OR UPPER(name) LIKE '%' || UPPER(#{word}) || '%' 
                                                        OR UPPER(name) LIKE '%' || UPPER(#{word}) || '%')
                          </otherwise>
                        </choose>
                        ORDER BY ingredno DESC
               )
    )
    WHERE <![CDATA[ r >= #{start_num} AND r <= #{end_num} ]]>
     
    <!-- 1 page: WHERE r >= 1 AND r <= 10; 
          2 page: WHERE r >= 11 AND r <= 20;
          3 page: WHERE r >= 21 AND r <= 30; -->
  </select>
</mapper>



