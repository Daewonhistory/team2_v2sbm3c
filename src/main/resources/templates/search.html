<!DOCTYPE html>
<html layout:decorate="~{mobile_layout}">
<div layout:fragment="content">
<script>
	document.addEventListener('DOMContentLoaded', function () {
    	
	});
	function submitForm(){
	   // 폼 데이터 가져오기
        const botareaBox = document.getElementsByName('botarea')[0];
        botareaBox.value = "";
        let all_botarea_button = document.getElementById('botarea_div').querySelectorAll('button');
        for(let botareaButton of all_botarea_button){
			console.log(botareaButton.value);
			if(botareaButton.classList.contains('btn_red')){
				botareaBox.value += botareaButton.value + "_";
			}
		}     
	    
		const form = document.getElementById('frm');
		form.submit();
	}
	
</script>
	<div>
		<span class="page_name">검색 결과</span>
	</div>
	<div>
		<form id="frm" name='frm' method='get' action='./search_list'>
			
			<section id="sec_reserve_condition">
				<span class="section_name">예약 조건</span><br>
				<label>인원:</label><input type="number" name="person" value="2">명
				<input type="date" id="reserve_date" name="date">
				<div class="vertical_scroll" id="scrollContainer">
					<button type="button" class="timebutton" onclick="selectTime(0, this)">0:00</button>
					<button type="button" class="timebutton" onclick="selectTime(1, this)">1:00</button>
					<button type="button" class="timebutton" onclick="selectTime(2, this)">2:00</button>
					<button type="button" class="timebutton" onclick="selectTime(3, this)">3:00</button>
					<button type="button" class="timebutton" onclick="selectTime(4, this)">4:00</button>
					<button type="button" class="timebutton" onclick="selectTime(5, this)">5:00</button>
					<button type="button" class="timebutton" onclick="selectTime(6, this)">6:00</button>
					<button type="button" class="timebutton" onclick="selectTime(7, this)">7:00</button>
					<button type="button" class="timebutton" onclick="selectTime(8, this)">8:00</button>
					<button type="button" class="timebutton" onclick="selectTime(9, this)">9:00</button>
					<button type="button" class="timebutton" onclick="selectTime(10, this)">10:00</button>
					<button type="button" class="timebutton" onclick="selectTime(11, this)">11:00</button>
					<button type="button" class="timebutton" onclick="selectTime(12, this)">12:00</button>
					<button type="button" class="timebutton" onclick="selectTime(13, this)">13:00</button>
					<button type="button" class="timebutton" onclick="selectTime(14, this)">14:00</button>
					<button type="button" class="timebutton" onclick="selectTime(15, this)">15:00</button>
					<button type="button" class="timebutton" onclick="selectTime(16, this)">16:00</button>
					<button type="button" class="timebutton" onclick="selectTime(17, this)">17:00</button>
					<button type="button" class="timebutton" onclick="selectTime(18, this)">18:00</button>
					<button type="button" class="timebutton" onclick="selectTime(19, this)">19:00</button>
					<button type="button" class="timebutton" onclick="selectTime(20, this)">20:00</button>
					<button type="button" class="timebutton" onclick="selectTime(21, this)">21:00</button>
					<button type="button" class="timebutton" onclick="selectTime(22, this)">22:00</button>
					<button type="button" class="timebutton" onclick="selectTime(23, this)">23:00</button>								
				</div>
				<input type="text" id="selected_time" name="time" value="">
				
				
			</section>
			<section id="sec_location">
				<span class="section_name">지역선택</span><span>(미선택시 전국기반 검색)</span><br>
		        <div id="midarea_div" >
		        	<button type="button"th:each="midAreaVO, status : ${midAreaList}"th:value="${midAreaVO.midareano}" th:text="${midAreaVO.name}"onclick="selectMidArea(this)"></button>
		        </div>
		        
		        <div id="botarea_div" style="display:none">
		        	
		        </div>
		        <input type="text" name="botarea">
			</section>
			<section id="sec_category" >
				<span class="section_name">카테고리(미선택시 모든카테고리 검색)</span><br>
				<button type="button"th:each="categoryVO, status : ${cateList}" th:onclick="|selectCategory(${categoryVO.categoryno})|" th:text="${categoryVO.name}"></button>
				<input type="number" id="categoryno" name="categoryno">
			</section>
			<section id="sec_price">
				<span class="section_name">가격</span>
				<h3></h3>
				<div>
					<label>최저가격: </label><input type="number" name="min_price" min="0" max="40" value="0">만 원<br>
					<label>최고가격: </label><input type="number" name="max_price" min="1" max="40" value="40">만 원 
				</div>
				
			</section>
			
			<div style="width: 100%;text-align: center;">
				<button type="submit" style="width:100px;margin:0px auto;">검색</button>
			</div>
			
			<div style="height: 80px;"></div>
		</form>
	</div>
	<script>
		window.onload=()=>{
			document.querySelectorAll('.timebutton')[1].click();
			document.getElementById('reserve_date').value= new Date().toISOString().substring(0, 10);	
			const form = document.getElementById('frm');
	    	const time1 = document.getElementById('time1');
	    	console.log(getTodayDate());
			document.getElementById('reserve_date').setAttribute('min', getTodayDate());
			
		    form.addEventListener('submit', function (event) {
		        // 기본 동작(페이지 새로고침) 막기
		        event.preventDefault();
		        
		        // submit 함수 호출
		        submitForm();
		    });
			time1.click();
		}
		
		//시간버튼 클릭 이벤트
		function selectTime(time, eventButton){
			let allBtnRed = document.getElementsByClassName('btn_red');
			let inputSelectedTime = document.getElementById('selected_time') 
			if(allBtnRed.length != 0){
				allBtnRed[0].classList.remove('btn_red');	
			}
			eventButton.classList.add('btn_red');
			inputSelectedTime.value = time;
		}
		
		function selectCategory(categoryno){
			let inputCategory = document.getElementById('categoryno');
			inputCategory.value = categoryno;
		}
		
		function selectMidArea(selectedMidArea){
			fetch(
	          "/botarea/botarea_list",
	          {
	            method: "POST",
	            headers: {"Content-Type": "application/json"},
	            body: JSON.stringify({"midareano": selectedMidArea.value})
	          }
	        )
	          .then((response) => response.json())
	          .then((rdata) => {
	            const divBotAreas = document.getElementById("botarea_div");
	            divBotAreas.innerHTML = '<h4>지역 소분류 선택</h4>';
	            
	            let allSelect = document.createElement("button");
	            allSelect.type = "button";
							allSelect.value = 0;
							allSelect.onclick=function() {
								selectBotarea(allSelect);
							};
							allSelect.classList.add('btn_botarea');
				            allSelect.textContent = "모든 지역";
				            
				            divBotAreas.appendChild(allSelect);
				            rdata.forEach(botAreaVO => {
				              const botArea = document.createElement("button");
				              botArea.textContent = botAreaVO.name;
				              botArea.type = "button";
				              botArea.name = "botareas";
				              botArea.onclick=function() {
								  selectBotarea(botArea);
							  };
							  botArea.value = botAreaVO.botareano;
							  botArea.classList.add('btn_botarea');
	              
	              divBotAreas.appendChild(botArea);
	              botarea_div.style.display="block";
	            });
	          });
		}
		function selectBotarea(eventButton){
			let selected_botarea_btn = eventButton;
			console.log(selected_botarea_btn.value);
			if(selected_botarea_btn.value == 0){
				let all_botarea_button = document.getElementById('botarea_div').querySelectorAll('button');
				if(selected_botarea_btn.classList.contains('btn_red')){
					for(const button of all_botarea_button){
						button.classList.remove('btn_red');
					}
				}else{
					for(const button of all_botarea_button){
						button.classList.add('btn_red');
					}
				}
			}else{
				if(selected_botarea_btn.classList.contains('btn_red')){
					let button = document.getElementById('botarea_div').querySelector('button');
					button.classList.remove('btn_red');
				}
				selected_botarea_btn.classList.toggle('btn_red');
			}
			
		}
		function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 1을 더해줍니다.
            const day = String(today.getDate()).padStart(2, '0');
            return year + '-' + month + '-' + day;
        }
	</script>
	<script>
        const scrollContainer = document.getElementById('scrollContainer');
        
        let isDown = false;
        let startX;
        let scrollLeft;

        scrollContainer.addEventListener('mousedown', (e) => {
            isDown = true;
            scrollContainer.classList.add('active');
            startX = e.pageX - scrollContainer.offsetLeft;
            scrollLeft = scrollContainer.scrollLeft;
        });

        scrollContainer.addEventListener('mouseleave', () => {
            isDown = false;
            scrollContainer.classList.remove('active');
        });

        scrollContainer.addEventListener('mouseup', () => {
            isDown = false;
            scrollContainer.classList.remove('active');
        });

        scrollContainer.addEventListener('mousemove', (e) => {
            if(!isDown) return;
            e.preventDefault();
            const x = e.pageX - scrollContainer.offsetLeft;
            const walk = (x - startX) * 3; //scroll-fast
            scrollContainer.scrollLeft = scrollLeft - walk;
        });
    </script>
</div>
</html>