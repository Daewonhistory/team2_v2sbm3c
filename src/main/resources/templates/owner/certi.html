<!DOCTYPE html>
<html layout:decorate="~{layout}"> <!-- layout.html 상속-->
<div layout:fragment="content">
<div th:text="${fail}">

</div>
<script>
  window.onload = function() {
    document.querySelector('#id').addEventListener('keypress', (event) => {
      if(event.key === 'Enter') {
        document.getElementById('btn_checkID').focus();
      }
    });

    document.querySelector('#passwd').addEventListener('keypress', (event) => {
      let passwd = document.getElementById('passwd').value.trim();
      if (passwd !== "" && event.key === 'Enter') {
        document.getElementById('passwd2').focus();
      } else if (passwd === "" && event.key === 'Enter') {
        document.getElementById('passwd').focus();
      }

    });

    document.querySelector('#passwd2').addEventListener('keypress', (event) => {
      let passwd2 = document.getElementById('passwd2').value.trim();
      if (passwd2 !== "" && event.key === 'Enter') {
        document.getElementById('oname').focus();
      } else if (passwd2 === "" && event.key === 'Enter') {
        document.getElementById('passwd2').focus();
      }
    });

    document.querySelector('#oname').addEventListener('keypress', (event) => {
      let oname = document.getElementById('oname').value.trim();
      if (oname !== "" && event.key === 'Enter') {
        document.getElementById('phone').focus();
      } else if (oname === "" && event.key === 'Enter') {
        document.getElementById('oname').focus();
      }
    });

    document.querySelector('#phone').addEventListener('keypress', (event) => {
      if(event.key === 'Enter') {
        document.getElementById('btn_DaumPostcode').focus();
      }
    });

    document.querySelector('#address2').addEventListener('keypress', (event) => {
      if(event.key === 'Enter') {
        document.getElementById('btn_send').focus();
      }
    });


  }




  function checkID() {
    let id = document.getElementById('id');
    let id_msg = document.getElementById('id_msg');

    if (id.value.trim().length == 0) {
      id_msg.style.fontSize = "12px";
      id_msg.innerHTML = 'ID가 누락되었습니다. ID 입력은 필수 입니다.';
      id_msg.style.marginTop = "5px";
      id_msg.classList.add('span_warning');    // class 적용
      id.focus();

      return false;  // 회원 가입 진행 중지

    }
    if (id.value.trim().length < 4) {
      id_msg.innerHTML = ' ID(이메일)는 3자이상 권장합니다.';
      id_msg.style.marginTop = "5px";
      id_msg.classList.add('span_warning');    // class 적용
      id.focus();

      return false;  // 회원 가입 진행 중지
    } else {  // when ID is entered
      id_msg.classList.remove('span_warning'); // class 삭제

      let id = document.getElementById('id');
      let url = './checkID?id=' + id.value;

      fetch(url, {
        method: 'POST'
      })
        .then(response => response.json())
        .then(rdata => {
          if (rdata.cnt > 0) { // 아이디 중복
            id_msg.innerHTML = '이미 사용중인 ID(이메일) 입니다. 다른 ID(이메일)을 지정해주세요.';
            id_msg.classList.add('span_warning');
            id.focus();
            setTimeout(function() {
              id_msg.innerHTML = '';
            }, 5000); // 5초 후에 내용을 지움


          } else { // 아이디 중복 안됨.
            id_msg.style.marginTop = "5px";
            id_msg.innerHTML = '사용 가능한 ID(이메일) 입니다.';
            id_msg.classList.add('span_info');
            document.getElementById('passwd').focus();
          }
        })
        .catch(error => { // 서버 다운등 통신 에러
          console.error('Error:', error);
        });

      // 처리중 출력
      id_msg.innerHTML = "<img src='/images/progress.gif' style='width: 5%;'>"; // static 기준

    }
  }

  function send() { // 회원 가입 처리
    let id = document.getElementById('id');
    let id_msg = document.getElementById('id_msg');



    let address1 = document.getElementById('address1');
    let address1_msg = document.getElementById('address1_msg');
    let address2 = document.getElementById('address2');
    let address2_msg = document.getElementById('address2_msg');




    if (id_msg.innerText.startsWith("이미")) {
      alert('ID 중복입니다.');
      return false;
    }
    if (!id_msg.classList.contains('span_info') ) {
      alert('ID 중복 확인을 먼저 진행해주세요.');
      return false; // 중복 확인을 먼저 하지 않았으므로 회원 가입 진행 중지
    }

    if (id.value.trim().length == 0) {
      id_msg.style.fontSize = "12px";
      id_msg.innerHTML = 'ID가 누락되었습니다. ID 입력은 필수 입니다.';
      id_msg.classList.add('span_warning');    // class 적용
      id.focus();

      return false;  // 회원 가입 진행 중지

    }
    if (id.value.trim().length < 4) {
      id_msg.innerHTML = ' ID(이메일)는 3자이상 권장합니다.';
      id_msg.style.marginTop = "5px";
      id_msg.classList.add('span_warning');    // class 적용
      id.focus();

      return false;  // 회원 가입 진행 중지
    }




    // 패스워드를 정상적으로 2번 입력했는지 확인
    let passwd = document.getElementById('passwd');
    let passwd2 = document.getElementById('passwd2');
    let passwd2_msg = document.getElementById('passwd2_msg');


    if (passwd.value.trim().length == 0) {

      alert('패스워드가 누락되었습니다. 패스워드 입력은 필수 입니다')
       // class 적용
      passwd.focus();

      return false;  // 회원 가입 진행 중지

    }

    if (passwd2.value.trim().length == 0) {

      alert('패스워드 확인이 누락되었습니다. 패스워드 입력은 필수 입니다')
      id_msg.classList.add('span_warning');    // class 적용
      passwd2.focus();

      return false;  // 회원 가입 진행 중지

    }

    if (passwd.value != passwd2.value) {
      passwd2_msg.innerHTML= '입력된 패스워드가 일치하지 않습니다.';
      passwd2_msg.classList.add('span_warning');    // class 적용
      passwd.focus();  // 첫번째 패스워드로 focus 설정

      return false;  // 회원 가입 진행 중지
    }

    let oname = document.getElementById('oname');
    let oname_msg = document.getElementById('oname_msg');

    if (oname.value.length == 0) {
      oname_msg.innerHTML= '이름 입력은 필수입니다.';
      oname_msg.classList.add('span_warning');    // class 적용
      oname.focus();

      return false;  // 회원 가입 진행 중지
    }



    if (address1.value.length == 0) {
      address1_msg.innerHTML= '주소 입력은 필수입니다.';
      address1_msg.classList.add('span_warning');    // class 적용
      address1.focus();

      return false;  // 회원 가입 진행 중지
    }

    if (address2.value.length == 0) {
      address2_msg.innerHTML= '상세주소 입력은 필수입니다.';
      address2_msg.classList.add('span_warning');    // class 적용
      address2.focus();

      return false;  // 회원 가입 진행 중지
    }
    document.getElementById('frm').submit(); // required="required" 작동 안됨.
  }
</script>



<div class='menu_line'></div>

<div style="width: 60%; margin: 0px auto ">
  <div class="title_line">사업자 인증 절차  (<span class="required">* </span>는 필수 )</div>
  <form   id="frm" name="frm" th:object="${ownerVO}" method="post" action="/owner/create">





    <div style="align-items: center;">

      <input class="form-control form-control-sm"  id="ownerno" name="ownerno" th:value="${ownerVO.ownerno}" style=" width: 27%;" readonly></input>

    </div>


    <div class="form-group" style="margin-top: 10px;">
      <label>사업자 번호</label>
      <input type='text' name='businessno' id='businessno' value=''
             placeholder="전화번호" class="form-control form-control-sm" style="width: 27%;">

    </div>
    <div class="form-group" style="margin-top: 10px;">
      <label>사업자 등록증 이미지</label>
      <input type='text' class="form-control" name='certifi_image' id='certifi_image' value='' placeholder="파일 선택">
    </div>

    <div class="form-group" style="margin-top: 10px;">
      <label>신분증 이미지</label>
      <input type='text' class="form-control" name='identi_card_image' id='identi_card_image' value='' placeholder="파일 선택">
    </div>









    <div class="form-group" style="margin-top: 10px;">
      <button type="button" class="btn btn-primary" onclick="return send()" id="btn_send">사업자 등록증 완료</button>
      <button type="button" class="btn btn-primary" onclick="location.href = '/';" id="btn_cancel">취소</button>
    </div>

  </form>
</div>
</div>
</html>




