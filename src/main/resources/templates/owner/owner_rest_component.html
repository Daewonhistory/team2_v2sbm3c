<!DOCTYPE html>
<div th:fragment="owner_rest_fragment"> <!-- <div th:replace=...-->


  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // 페이지가 로드된 후 카테고리 번호 값을 가져오기
      var categorynoElement = document.getElementById("categoryno");
      if (categorynoElement) {
        var categoryno = categorynoElement.innerText;

        // fetch API를 사용하여 AJAX 요청 보내기
        fetch(`/category/catelist_no?categoryno=${categoryno}`)
            .then(response => {
              if (!response.ok) {
                throw new Error('네트워크 응답이 올바르지 않습니다.');
              }
              return response.json();
            })
            .then(data => {
              // 성공적으로 응답을 받은 경우
              console.log('성공:', data);
              var categorynameElement = document.getElementById("categoryname");
              categorynameElement.innerText = data[0].name;
              // 필요한 경우 여기서 UI 업데이트 등 추가 작업을 수행할 수 있습니다.
            })
            .catch(error => {
              // 오류가 발생한 경우
              console.log('오류:', error);
            });
      } else {
        console.log("카테고리 번호 요소를 찾을 수 없습니다.");
      }
    });
  </script>

  <div class="container" th:each="restDTO: ${searchlist}">
    <div class="row">
      <div class="col-md-6 offset-md-3">
        <div class="card">
          <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active" th:if="${restDTO.image1 != null}">
                <img class="d-block w-100" th:src="@{|/restaurant/storage/${restDTO.image1}|}" alt="사진1">
              </div>
              <div class="carousel-item" th:if="${restDTO.image2 != null}">
                <img class="d-block w-100" th:src="@{|/restaurant/storage/${restDTO.image2}|}" alt="사진2">
              </div>
              <div class="carousel-item" th:if="${restDTO.image3 != null}">
                <img class="d-block w-100" th:src="@{|/restaurant/storage/${restDTO.image3}|}" alt="사진3">
              </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </a>
          </div>
          <div class="card-body">
            <h5 class="card-title" th:text="${restDTO.name}">식당 이름</h5>
            <p style="display: none;" class="card-text">카테고리: <span id="categoryno" th:text="${restDTO.categoryno}"></span></p>
            <p class="card-text">카테고리: <span id="categoryname"></span></p>
            <p class="card-text">사업자 번호: <span th:text="${restDTO.ownerno}"></span></p>
            <div>
              <a th:href="@{|/owner/restread|}" style="color: whitesmoke;" class="btn btn-primary">상세 보기</a>
              <a th:href="@{|./update_imgs|}" style="color: whitesmoke;" class="btn btn-success">이미지 수정</a>
              <a href="#" style="color: whitesmoke;" class="btn btn-danger" th:attr="onclick=|deleteRest('${restDTO.name}')|">삭제</a>
            </div>
            <script>
              function deleteRest(restName) {
                if (confirm("정말 " + restName + "을(를) 삭제하시겠습니까?")) {
                  // User confirmed the deletion


                  fetch('/owner/delete_rest', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',

                    },
                    body: JSON.stringify({ name: restName })
                  })
                      .then(response => {
                        if (response.ok) {
                          alert(restName + "이(가) 삭제되었습니다.");
                          location.reload(); // Refresh the page
                          // Optionally, refresh the page or remove the item from the DOM
                        } else {
                          alert("삭제에 실패했습니다.");
                        }
                      })
                      .catch(error => {
                        console.error('Error:', error);
                        alert("삭제 중 오류가 발생했습니다.");
                      });
                } else {
                  // User canceled the deletion
                  alert("삭제가 취소되었습니다.");
                }
              }
            </script>
          </div>
        </div>
      </div>
    </div>
  </div>


<!-- 페이지 버튼 목록 출력 시작 -->
</div>


