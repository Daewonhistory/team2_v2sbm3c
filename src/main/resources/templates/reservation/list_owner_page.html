<!DOCTYPE html>
<html layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=yes, initial-scale=1.0, minimum-scale=1.0, maximum-scale=10.0, width=device-width">
    <title>전체 예약 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet" type="text/css">
</head>
<body layout:fragment="content">
    <div>
        <h2>전체 예약 목록</h2>
        <form th:action="@{/reservation/list_owner_page}" method="get">
            <label for="reserve_date">예약 날짜:</label>
            <input type="date" id="reserve_date" name="reserve_date" th:value="${reserve_date}">
            <label for="restno">식당 선택:</label>
            <select id="restno" name="restno" th:onchange="this.form.submit()">
                <option value="0">전체 식당</option>
                <option th:each="restaurant : ${RestList}" th:value="${restaurant.restno}" th:text="${restaurant.name}" th:selected="${restno == restaurant.restno}"></option>
            </select>
            <button type="submit">검색</button>
        </form>
        <table class="table">
            <thead>
                <tr>
                    <th>예약 번호</th>
                    <th>예약 날짜</th>
                    <th>인원수</th>
                    <th>고객 이름</th>
                    <th>식당 이름</th>
                    <th>수정/삭제</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="reserve : ${list}">
                    <td th:text="${reserve.reserveno}"></td>
                    <td th:text="${reserve.sub_date}"></td>
                    <td th:text="${reserve.person}"></td>
                    <td th:text="${reserve.nickname}"></td>
                    <td th:text="${reserve.restname}"></td>
                    <td>
                        <a th:href="@{|/reservation/update?reserveno=${reserve.reserveno}&now_page=${now_page}|}"><img src="/images/update.png" class="icon"></a>
                        <a th:attr="onclick=|delete_check_owner_page(${reserve.reserveno}, ${now_page}, '${reserve_date}', ${restno})|"><img src="/images/delete.png" class="icon"></a>
                    </td>
                </tr>
            </tbody>
        </table>
        <div th:utext="${paging}"></div>
    </div>
    <script>
        function delete_check_owner_page(reserveno, now_page, reserve_date, restno) {
            if (confirm("정말 삭제하시겠습니까?")) {
                let f = document.createElement('form');
                let obj1 = document.createElement('input');
                obj1.type = 'hidden';
                obj1.name = 'reserveno';
                obj1.value = reserveno;
                let obj2 = document.createElement('input');
                obj2.type = 'hidden';
                obj2.name = 'now_page';
                obj2.value = now_page;
                let obj3 = document.createElement('input');
                obj3.type = 'hidden';
                obj3.name = 'reserve_date';
                obj3.value = reserve_date;
                let obj4 = document.createElement('input');
                obj4.type = 'hidden';
                obj4.name = 'restno';
                obj4.value = restno;
                f.appendChild(obj1);
                f.appendChild(obj2);
                f.appendChild(obj3);
                f.appendChild(obj4);
                f.setAttribute('method', 'post');
                f.setAttribute('action', '/reservation/delete_owner_page');
                document.body.appendChild(f);
                f.submit();
            }
        }
    </script>
</body>
</html>
