<!DOCTYPE html>
 
<html layout:decorate="~{layout}"> <!-- layout.html 상속-->
<div layout:fragment="content">
	<link rel="stylesheet" href="/css/paging.css">
  <div class="title_line">식재료 검색
    <span th:if="${word != null and word != ''}" th:text="|${word} ${search_count} 건|"></span> 
  </div>
  <aside class="aside_right">
    <a href="javascript: location.reload();">새로 고침</a>
  </aside>
  
  <div style="text-align: right; clear:both;">
    <form name="frm_search" method="get" action="/ingredient/list">
      <input type="text" name="word" id="word" th:value="${word}" >
      <input type="hidden" name="now_page" id="now_page" value="1" >
      <button type='button' class='btn btn-secondary btn-sm' onclick='search()' style="padding: 2px 8px 3px 8px; margin: 0px 0px 2px 0px;">검색</button>
      <span th:if="${word != null}">     
        <button type='button' onclick="location.href='/ingredient/list_search'"class='btn btn-secondary btn-sm' style="padding: 2px 8px 3px 8px; margin: 0px 0px 2px 0px;">검색 취소</button>
      </span>
    </form>  
  </div>
  
  <div class="menu_line"></div>
    
    <div style="width: 80%; margin: 0px auto;">
    <form name="frm" th:object="${ingredientVO}" method="post" action="/ingredient/create">
      <input type="hidden" name="word" th:value="${word}">
      <input type="hidden" name="now_page" th:value="${now_page}">
      <div style="margin-right: 5px; width: 26%; float: left;">
        <input type="text" name="name" value="" autofocus="autofocus"
               class="form-control fom-control-sm" style="width: 100%;" placeholder="새로 추가할 재료명을 입력해주세요.">
      </div>
      <div style="width: 25%; float: left; margin-top: 3px;">
        <button type="submit" class="btn btn-secondary btn-sm">등록</button>
        <button type="button" onclick="location.href='/ingredient/list_search_paging?word=&now_page=1'" class="btn btn-secondary btn-sm">취소</button>        
      </div>
    </form>  
  </div>	
  <table class="manager-user-list">
    <colgroup>
      <col style='width: 20%;'/>
      <col style='width: 50%;'/>
      <col style='width: 30%;'/>
    </colgroup>
    <thead>
      <tr class="manager-header">
        <th class="th_bs">번호</th>
        <th class="th_bs">재료명</th>
        <th class="th_bs">수정 / 삭제</th>
      </tr>
    </thead>
    <tbody id="tbody">
    </tbody>
  </table>  
  
  <div id="bottom_menu"></div>
	
	<script>
	let now_page_value = 1;
  window.onload = () => {
	  send();
  }
  function search() {
    now_page_value = 1;
    send();
  }
  
  // 페이지 이동
  function pageMove(movePage) {
    now_page_value =  parseInt(movePage.dataset.page);
    send();
  }
  
  function pageGrpMove(movePageGrp){
  	now_page_value =  parseInt(movePage.dataset.page);
    send();
	}
  function send(){
	  const word = document.querySelector("#word");
	  
	  fetch(
      "/ingredient/list",
      {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
					"word": word.value,
					"now_page": parseInt(now_page_value)
				})
      }
    ).then((response) => response.json())
    .then((rdata) => {
      const resultBody = document.getElementById("tbody");
      resultBody.innerHTML = ``;
      const bottommenu = document.querySelector("#bottom_menu");
      bottommenu.innerHTML = '';
      rdata.ingredientList.forEach((ingredientVO) => {
        const row = document.createElement("tr");
				row.classList.add("manager-data");
        row.innerHTML = `
          <td class="td_basic">
            <span>${ingredientVO.ingredno}</span>
          </td>
          <td class="td_basic">
            <span>${ingredientVO.name}</span>
          </td>
          <td class="td_bs">
              <a href="/ingredient/update?ingredno=${ingredientVO.ingredno}">
                  <img src="/cate/images/update.png" class="icon">
              </a>
              <a onclick="delete_check(${ingredientVO.ingredno}, '${word.value}', ${now_page_value})">
                  <img src="/cate/images/delete.png" class="icon">
              </a>
          </td>
        `;
        resultBody.appendChild(row);
      });

      bottommenu.innerHTML = rdata.paging;
			
    });
  }
	function delete_check(ingredno, word, now_page){
  	if (confirm("정말 삭제하시겠습니까??") == true){    //확인
  		let f = document.createElement('form');
    
	    let obj1;
	    obj1 = document.createElement('input');
	    obj1.type = 'hidden';
	    obj1.name = 'ingredno';
	    obj1.value = ingredno;
		    
			let obj2;
			obj2 = document.createElement('input');
	    obj2.type = 'hidden';
	    obj2.name = 'word';
	    obj2.value = word;
			
			let obj3;
			obj3 = document.createElement('input');
	    obj3.type = 'hidden';
	    obj3.name = 'now_page';
	    obj3.value = now_page;
		
	    f.appendChild(obj1);
	    f.appendChild(obj2);
	    f.appendChild(obj3);
	    f.setAttribute('method', 'post');
	    f.setAttribute('action', '/ingredient/delete');
	    document.body.appendChild(f);
	    f.submit();
  	}else{   //취소
    	return;
  	}
	}
  </script>

</div> 
</html>