<!DOCTYPE html>
<html layout:decorate="~{layout}">
  <head>
    <title>즐겨찾기 리스트</title>
    <!-- 필요한 CSS 및 JS 파일들 추가 -->
  </head>
  <body>
    <!-- layout.html 상속-->
    <div layout:fragment="content">
      <div class="title_line">
        <span id="user-id" class="title_line_text"></span>
        즐겨찾기 리스트 <span id="user-name" class="title_line_text"></span>
      </div>

      <aside class="aside_right">
        <a href="javascript:location.reload();">새로고침</a>
        <span class="menu_divide">│</span>
      </aside>

      <div class="menu_line"></div>

      <div style="width: 100%">
        <input type="hidden" id="custno" value="22" /> 

        <!-- 북마크 table 시작 -->
        <table class="table table-striped" style="width: 100%">
          <colgroup>
            <col style="width: 5%" />
            <col style="width: 10%" />
            <col style="width: 10%" />
          </colgroup>
          <tr>
            <th class="th_bs" style="text-align: center;">순서</th>
            <th class="th_bs" style="text-align: center;">식당이름</th>
            <th class="th_bs" style="text-align: center;">삭제</th>
          </tr>
          <tbody id="favorite-list">
            <!-- 즐겨찾기 항목이 여기에 동적으로 추가됩니다 -->
            <tr th:each="favorite : ${list}">
              <td class="td_basic" style="text-align: center; vertical-align: middle;" th:text="${favorite.favoriteno}"></td>
              <td class="td_basic" style="text-align: center; vertical-align: middle;" th:text="${favorite.restname}"></td>
              <td class="td_basic" style="text-align: center; vertical-align: middle;">
                <button type="button" th:onclick="|deleteBookmark(${favorite.favoriteno})|">즐겨찾기 삭제</button>
              </td>
            </tr>
            <tr th:if="${list.size() == 0}">
              <td class="td_basic" style="text-align: center; vertical-align: middle;" colspan="4">즐겨찾기가 등록되지 않았습니다.</td>
            </tr>
          </tbody>
        </table>
      </div>
      
            <!-- deleteBookmark 함수 정의 -->
      <script>
        function deleteBookmark(favoriteno) {
            if (!confirm("정말로 삭제하시겠습니까?")) {
                return;
            }
  
            const favorite = {
                favoriteno: favoriteno
            };
  
            fetch('/favorite/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(favorite)
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    location.reload(); // 페이지 새로고침하여 삭제된 즐겨찾기 반영
                } else {
                    alert('즐겨찾기 삭제에 실패했습니다.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('즐겨찾기 삭제 중 오류가 발생했습니다.');
            });
        }
      </script>
    </div>


  </body>
</html>
