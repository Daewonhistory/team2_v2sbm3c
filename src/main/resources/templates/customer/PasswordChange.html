<!DOCTYPE html>
<html layout:decorate="~{mobile_layout}">
<head>
  <style>
    .submit {
      justify-content: center;
      display: flex;
    }
    .label-inline {
      display: inline-block;
      width: 150px;
      font-size: 13px;
    }
    .text-input {
      width: 200px;
    }
    .auth-button {
      margin-top: 20px;
    }
  </style>
</head>
<body>
<div layout:fragment="content">
  <div class="submit">
    <h2>비밀번호 수정</h2>
  </div>
  <section class="findId-section" style="margin-top: 20px;">
    <div class="findId-info">
      <label>아이디: </label><span id="userId">kksos28</span>
    </div>
    <form id="passwordForm" method="post" action="/customer/passwordChange" onsubmit="return validatePasswords()">
      <div class="form-group" style="margin-top: 20px;">
        <label class="label-inline">변경할 패스워드</label>
        <input type="password" name="passwd" id="newPassword" class="text-input" required>
      </div>
      <div class="form-group">
        <label class="label-inline">변경할 패스워드 확인</label>
        <input type="password" id="confirmPassword" class="text-input" required>
      </div>
      <input type="hidden" id="userIdInput" name="id" value="kksos28">
    </form>
  </section>
  <div class="submit">
    <button type="submit" form="passwordForm" class="auth-button">수정</button>
  </div>
</div>

<script>
  function validatePasswords() {
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    if (newPassword !== confirmPassword) {
      alert('새로운 패스워드가 일치하지 않습니다.');
      return false;
    }

    // 아이디 값을 hidden input에 추가
    const userId = document.getElementById('userId').innerText.trim();
    const idInput = document.createElement('input');
    idInput.type = 'hidden';
    idInput.name = 'id';
    idInput.value = userId;
    document.getElementById('passwordForm').appendChild(idInput);

    // 패스워드 필드를 폼 데이터에 추가
    const newPasswordField = document.getElementById('newPassword');
    newPasswordField.name = 'passwd';

    // 폼 전송 전에 패스워드 필드를 삭제
    const passwordFields = [newPasswordField, document.getElementById('confirmPassword')];
    passwordFields.forEach(field => {
      field.parentNode.removeChild(field);
    });

    // 서버로 폼 제출
    return true;
  }
</script>

</body>
</html>
