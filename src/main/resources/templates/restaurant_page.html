<!DOCTYPE html>
<html layout:decorate="~{mobile_layout}">
<div layout:fragment="content" style="padding:0">
	<nav>
        <ul>
            <li><a th:href="|/restaurant/main_page?restno=${restno}&person=${person}&date=${date}|">홈</a></li>
            <li><a th:href="|/menu/menuAllList?restno=${restaurantVO.restno}&person=${person}&date=${date}|">메뉴</a></li>
            <li><a href="#section3">리뷰</a></li>
        </ul>
    </nav>
	<div>
		<span class="page_name">레스토랑</span>
	</div>
	
	<section id="home" style="height: 300px; margin:0; padding:0">
        <div class="slider" id="slider">
		  <div class="slide"><a href="https://www.naver.com"><img th:src="|/restaurant/storage/${restaurantVO.image1}|" alt="Slide 1"></a></div>
		  <div class="slide"><img th:src="|/restaurant/storage/${restaurantVO.image2}|" alt="Slide 2"></div>
		  <div class="slide"><img th:src="|/restaurant/storage/${restaurantVO.image3}|" alt="Slide 3"></div>
		  <!-- Add more slides as needed -->
		  <button class="arrow left" id="prev">&lt;</button>
		  <button class="arrow right" id="next">&gt;</button>
		</div>
		<div style="height: 15%;display: flex;justify-content: center;align-items: center;">
			<div class="radio_buttons" id="radio_buttons"></div>
		</div>
			
    </section>
	<section id="restaurant_info_section">
		<div>
			<div>
				<span id="rest_name" th:text="${restaurantVO.name}"></span>
			</div>
			<div>
				<img src="star" alt="별이미지">
				<span id="rate">5.0</span>
			</div>
		</div>	
	</section>
	<section id="sec_reserve_condition">
			<span class="section_name">예약 조건</span><br>
				<input type="hidden" name="admit_personno">
				<input type="hidden" id="restno" name="restno" th:value="${restaurantVO.restno}"><br>
				<label>인원:</label><input type="number" id="personnel" name="person" th:value="${person}" onchange="searchPossibleTime()">명<br>
				<label>날짜:</label><input type="date" id="reserve_date" onchange="searchPossibleTime()" name="date" th:value="${date}"><br>
				<input type="hidden" name="time" value="2">
				<div class="vertical_scroll" id="scrollContainer">
				
							
		</div>
	</section>
	<section>
		<h2>식당 공지</h2>
		<div id="notice_area" style="height: 200px; overflow-x: hidden ; overflow-y: scroll; padding:4px">
			<div id="notice_info" th:each="noticeVO, status: ${noticeList}" style="width:100%; margin:3px; overflow: hidden; overflow-wrap: break-word;">
				<h3 th:text="${noticeVO.title}"></h3>
				<span th:text="${noticeVO.content}"></span>
			</div>
		</div>
	</section>
	<div style="height: 80px;"></div>
	<script>
		window.onload = () => {
			searchPossibleTime();
			document.getElementById('reserve_date').setAttribute('min', getTodayDate());
		}
		let slider = document.getElementById('slider');
		let isDown = false;
		let startX;
		let walk;
		
		slider.addEventListener('mousedown', (e) => {
		  isDown = true;
		  startX = e.pageX;
		  walk = 0;
		  slider.style.cursor = 'grabbing';
		});
		
		slider.addEventListener('mouseleave', () => {
		  if (!isDown) return;
		  isDown = false;
		  slider.style.cursor = 'grab';
		  if (walk < -50) {
		    nextSlide();
		  } else if (walk > 50) {
		    prevSlide();
		  } else {
		    showSlide(currentIndex); // Reset to the current slide if not dragged far enough
		  }
		});
		
		slider.addEventListener('mouseup', () => {
		  if (!isDown) return;
		  isDown = false;
		  slider.style.cursor = 'grab';
		  if (walk < -50) {
		    nextSlide();
		  } else if (walk > 50) {
		    prevSlide();
		  } else {
		    showSlide(currentIndex); // Reset to the current slide if not dragged far enough
		  }
		});
		
		slider.addEventListener('mousemove', (e) => {
		  if (!isDown) return;
		  e.preventDefault();
		  const x = e.pageX;
		  walk = x - startX;
		  slides.forEach((slide, index) => {
		    slide.style.transform = `translateX(${100 * (index - currentIndex) + (walk / slider.clientWidth) * 100}%)`;
		  });
		});
		
		let currentIndex = 0;
		const slides = document.querySelectorAll('.slide');
		const radioButtonsContainer = document.getElementById('radio_buttons');
		
		// Create radio buttons dynamically based on the number of slides
		slides.forEach((slide, index) => {
		  const radio = document.createElement('input');
		  radio.type = 'radio';
		  radio.className = 'radio_button';
		  radio.name = 'slider';
		  radio.id = `radio_${index + 1}`;
		  if (index === 0) radio.checked = true;
		
		  radio.addEventListener('change', () => {
		    showSlide(index);
		  });
		
		  radioButtonsContainer.appendChild(radio);
		});
		
		function showSlide(index) {
		  slides.forEach((slide, i) => {
		    slide.style.transform = `translateX(${100 * (i - index)}%)`;
		  });
		  document.getElementById(`radio_${index + 1}`).checked = true;
		  currentIndex = index;
		}
		
		function nextSlide() {
		  currentIndex = (currentIndex + 1) % slides.length;
		  showSlide(currentIndex);
		}
		
		function prevSlide() {
		  currentIndex = (currentIndex - 1 + slides.length) % slides.length;
		  showSlide(currentIndex);
		}
		
		function searchPossibleTime(){
			const reserveDate = document.getElementById("reserve_date");
			const personnel = document.getElementById("personnel");
			const restno = document.getElementById("restno");
			console.log(reserveDate.value + " " + personnel.value + " " + restno.value);
			
			fetch(
	          "/admitPerson/searchPossibleTime",
	          {
	            method: "POST",
	            headers: {"Content-Type": "application/json"},
	            body: JSON.stringify({
					"restno": restno.value,
					"personnel": personnel.value,
					"date": reserveDate.value
					})
	          }
	        )
	          .then((response) => response.json())
	          .then((rdata) => {
	            const scrollContainer = document.getElementById("scrollContainer");
	            scrollContainer.innerHTML = '';
	            
	            rdata.forEach(admitPersonVO => {
	              const timeButton = document.createElement("button");
	              timeButton.textContent = admitPersonVO.time + ":00";
	              timeButton.dataset.admitpersonno = admitPersonVO.admitpersonno;
	              timeButton.type = "button";
							  timeButton.value = admitPersonVO.admitpersonno;
							  timeButton.classList.add('btn_botarea');
	              
	              timeButton.addEventListener('click', function() {
	                const admitpersonno = this.dataset.admitpersonno;
	                const person = document.getElementById('personnel').value;
	                window.location.href = `/reservation/create?admitpersonno=${admitpersonno}&person=${person}`;
            		});
	              scrollContainer.appendChild(timeButton);
	              
	              
          		});
        		});
		}
		
		function getTodayDate() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 1을 더해줍니다.
        const day = String(today.getDate()).padStart(2, '0');
        return year + '-' + month + '-' + day;
    }
    
		document.getElementById('next').addEventListener('click', nextSlide);
		document.getElementById('prev').addEventListener('click', prevSlide);
		
		showSlide(currentIndex);
		
		
	</script>
</div>
</html>